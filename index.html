<head>
  <title>ESAT Tool</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  
  <meta charset="utf-8">
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
  <link rel="stylesheet" href="./radar-chart.css">

  <style>
  body {
    padding: 20px;
  }
  </style>

  <style>
  #mybelief{
    font-family: "Roboto";
    font-weight: var(--md-outlined-button-label-text-weight, var(--md-sys-typescale-label-large-weight, var(--md-ref-typeface-weight-medium, 500)));
    font-size:0.875rem;
    font-style: italic;
    color:#6750A4;
    border:solid #E8DEF8;
    background-color: #E8DEF8;
    border-radius: 5px;
    text-align: justify;
    height: fit-content;
    padding:5px;
  }

  #fmb{
    margin-left: 20 px;
    font-family: "Roboto";
    font-weight: var(--md-outlined-button-label-text-weight, var(--md-sys-typescale-label-large-weight, var(--md-ref-typeface-weight-medium, 500)));
    font-size:1rem;
    color:#6750A4;
    background-color: #E8DEF8;
    border-radius: 5px;
  }

  legend{
    padding-left: 2px;
    padding-right: 2px;
    padding-bottom: 2px;
  }

  #radar{
    width: fit-content;
  }

  #resZone{
    margin-top: 20px;
    align-items: center;
    display:flex;
  }
  .radar-chart .area {
    fill-opacity: 0.7;
  }
  .radar-chart.focus .area {
    fill-opacity: 0.3;
  }
  .radar-chart.focus .area.focused {
    fill-opacity: 0.9;
  }
  .area.result, .result .circle {
    fill: #ADD8E6;
    stroke: none;
  }
  .centerMe{
    margin: auto;
  }
  </style>

  <!--Radar diagram-->
  <script src="./d3.v3.js"></script>
  <script src="./radar-chart.js"></script>
  <script>
    RadarChart.defaultConfig.color = function() {};
    RadarChart.defaultConfig.radius = 3;
    RadarChart.defaultConfig.w = 400;
    RadarChart.defaultConfig.h = 400;
  </script>

</head>
<body>
  <h1 class="md-typescale-display-medium">Quizz Epistemologie</h1>
  <md-linear-progress id="progress" value="0"></md-linear-progress>
  <form id="mainForm">
    <p id="quizz" class="md-typescale-body-medium">Check out these controls in a form!</p>
    <!--<md-outlined-button type="reset" onclick="Aclicked()">A</md-outlined-button>
    <md-outlined-button type="reset" onclick="Bclicked()">B</md-outlined-button>
    <md-outlined-button type="reset"onclick="Cclicked()">C</md-outlined-button>-->
  </form>
  <div id="resZone">
    <div id="radar"></div>
    <fieldset id="fmb">
      <legend>Ma posture √©pist√©mologique</legend>
      <div id="mybelief"></div>
    </fieldset>
  </div>
  <style>
    form {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }
  </style>
  <script>
    NO_ANSWER = "X"
    CURRENT_QUESTION = 0
    MY_BELIEF = ""
    DO_I_AGREE_WITH_MY_STAND = false
    SHOW_BELIEF_DURING_ANSWER = false

    QUIZZ_ELEMENT = document.getElementById("mainForm")

    RANDOMIZE_QUESTIONS = false
    RANDOMIZE_ITEMS = true

    CATEGORIES = new Map() //Used know the different categories existing to classify the user answers in the end. Used in the radar
    ANSWERED_CATEGORIES = new Map()
    EPISTEMOLOGY_STAND_DEF = new Map()

    QUESTIONS = []

    loadQuestions()
    loadEpistemologyStands()
    
        
    initQuizz()

    function update()
    {
        prog = document.getElementById("progress")
        val = CURRENT_QUESTION/QUESTIONS.length*1.0
        prog.value = ""+ val

        if(val == 1.0)
        {
          //quizzEnd()
          announceOfEpistemologyStand()
          return; // RETURN IF END ! Otherwise continue
        }


        quizzQ = '<p id="quizz" class="md-typescale-body-medium">'+QUESTIONS[CURRENT_QUESTION].q_title+'</p>'

        let items = QUESTIONS[CURRENT_QUESTION].items
        
        //Building appropriate buttons for the quizz
        let quizzButtons = []

        for (i in items)
        {
         quizzButtons.push('<md-outlined-button type="reset" data-symb="'+items[i].i_id+'">'+items[i].i_title+'</md-outlined-button>')
        }

        if(RANDOMIZE_ITEMS)
          shuffleArray(quizzButtons)

        QUIZZ_ELEMENT.innerHTML = quizzQ + quizzButtons.join("")
        updateMyBelief()
    }

    function updateMyBelief()
    {
      let Final_Connectors = Array("Enfin, ", "Finalement, ", "Pour finir, ")
      //let Opinion_Connectors = Array("je pense que ", "selon moi, ", "pour moi, ", "pour moi, je pense que ", "aussi, ", "il m'appara√Æt que ", "j'estime que ")
      let Opinion_Connectors = Array("je pense que ", "il me semble que ", "pour moi, je pense que ", "il m'appara√Æt que ", "j'estime que ", "je cro√Æs que ", "j'estime que ")
      let beliefString = Opinion_Connectors[Math.floor(Math.random()*(Opinion_Connectors.length-4))]//Pick only the first three ones
      beliefString = beliefString.charAt(0).toUpperCase() + beliefString.slice(1)

      let arrProp = []

      for(let [key,value] of ANSWERS)
      {
        if(value == NO_ANSWER)
          continue

        arrProp.push(((QUESTIONS.reduce((a,x) => x.q_id == key ? x : a).items.reduce( (b,y) => y.i_id == value ? y : b).i_title)).toLowerCase()) //HF ;)
      }

      //Below, formatting of the belief ==> Could be replaced by a GPT if available and used to tell a story!

      for(let prop = 0 ; prop < arrProp.length-1 ; prop++)
      {
        if(prop!=0 && Math.random()>0.65)
        {
          let conn = Opinion_Connectors[Math.floor(Math.random()*Opinion_Connectors.length)]
          conn = conn.charAt(0).toUpperCase() + conn.slice(1)
          
          beliefString += " "+conn+arrProp[prop]
        }
        else
        {
          let posLastDot = beliefString.lastIndexOf(".")
          if(posLastDot == -1)
            beliefString += arrProp[prop]
          else
            beliefString = beliefString.slice(0,posLastDot)+", que " + arrProp[prop]
        }
      }
      //Adding the last element to belief. The format depends on how many elements are in the sentences
      if(arrProp.length > 2)
        beliefString += " " + Final_Connectors[Math.floor(Math.random()*Final_Connectors.length)]+Opinion_Connectors[Math.floor(Math.random()*Opinion_Connectors.length)]+arrProp[arrProp.length-1]
      else if(arrProp.length > 1)
      {
        let posLastDot = beliefString.lastIndexOf(".")
        beliefString = beliefString.slice(0,posLastDot)+ " et que "+ beliefString.slice(posLastDot+1) + arrProp[arrProp.length-1]
      }
      else
        beliefString += arrProp[arrProp.length-1]

      if(arrProp.length == 0)
        beliefString = ""
      
      //console.log(arrProp)
      MY_BELIEF = beliefString
      let beliefDiv = document.getElementById("mybelief")
      beliefDiv.innerHTML=beliefString
    }

    function initQuizz()
    {
      ANSWERS = new Map()
      for(q in QUESTIONS)
      {
          ANSWERS.set(QUESTIONS[q].q_id,NO_ANSWER)
      }

      if(RANDOMIZE_QUESTIONS)
        shuffleArray(QUESTIONS)
      
      QUIZZ_ELEMENT.addEventListener('click', addClick)
      CURRENT_QUESTION = 0

      if (SHOW_BELIEF_DURING_ANSWER)
        document.getElementById("fmb").style.visibility = 'visible'
      else
        document.getElementById("fmb").style.visibility = 'hidden'

      removeRadar()
      update()
    }

    function addClick(event)
    {
        const isButton = event.target
        if(!isButton.dataset.symb)
          return; //NTD false click
        questionAnswered(event.target.dataset.symb)
    }

    function announceOfEpistemologyStand()
    {
      updateAnsweredCategories()

      // Here, display stand and def.
      res = "Vous √™tes "+getMaxAnsweredCategories()
      def = EPISTEMOLOGY_STAND_DEF[getMaxAnsweredCategories()]

      // display button OUI NON si ok avec la def
      QUIZZ_ELEMENT.innerHTML = '<div id="standDisplay" class="centerMe">Il semblera√Æt que votre posture √©pist√©mologique soit <strong>'+getMaxAnsweredCategories()+'</strong></div>'+
      '<div id="epStandDef" class="centerMe">'+EPISTEMOLOGY_STAND_DEF[getMaxAnsweredCategories()]+'</div><div class="centerMe">Vous reconnaissez-vous dans cette description ?</div>'+
      '<div class="centerMe"><md-outlined-button class="centerMe" type="reset" onclick="okWithStand()">Oui üëç</md-outlined-button>' +
      '<md-outlined-button class="centerMe" type="reset" onclick="notOkWithStand()">Non üëé</md-outlined-button></div>'
    }

    function okWithStand(){
      DO_I_AGREE_WITH_MY_STAND = true
      quizzEnd()
    }

    function notOkWithStand(){
      DO_I_AGREE_WITH_MY_STAND = false
      quizzEnd()
    }
    
    function quizzEnd()
    {
        QUIZZ_ELEMENT.innerHTML = '<p id="quizz" class="md-typescale-body-medium centerMe">Le quizz est fini.Merci.</p>'+
        '<md-outlined-button class="centerMe" type="reset" onclick="initQuizz()">Recommencer le quizz ?</md-outlined-button>'
        
        //SHOULD DISPLAY THE NUMBER OF ANSWERS BY ITEM
        // updateAnsweredCategories()

        document.getElementById("fmb").style.visibility = 'visible' // In any case, display belief at the end
        //displayLinearProgress()
        displayRadar()

        exporter()
    }

    function displayLinearProgress()
    {
        display = ""
        for(let[key,value] of ANSWERED_CATEGORIES)
        {
          display += '<p>'+key+' : <md-linear-progress id="progress" value="'+value/QUESTIONS.length+'"></md-linear-progress></p>'
        }
      QUIZZ_ELEMENT.innerHTML+=display
    }

    function updateAnsweredCategories()
    {
      ANSWERED_CATEGORIES = new Map()
      for(let [key,val] of CATEGORIES)
        ANSWERED_CATEGORIES.set(key,0)

      
      for(let [key,value] of ANSWERS)
      {
        for(let i in QUESTIONS)
        {
          if(QUESTIONS[i].q_id == key)
          {
            for(let j in QUESTIONS[i].items)
            {
              if(QUESTIONS[i].items[j].i_id == value)
              {
                for(let k in QUESTIONS[i].items[j].categ)
                {
                  ANSWERED_CATEGORIES.set(QUESTIONS[i].items[j].categ[k].i_symb, ANSWERED_CATEGORIES.get(QUESTIONS[i].items[j].categ[k].i_symb)+QUESTIONS[i].items[j].categ[k].w)
                }
              }
            }
          }
        }
        //ANSWERED_CATEGORIES.set(value,ANSWERED_CATEGORIES.get(value)+1)
      }
      //return ANSWERED_CATEGORIES //@DEPRECATED return for legacy purpose
    }

    // @TODO This function is used to classify the epistemological stand of the user
    function classify()
    {
      assert(true == false)
    }

    // @TODO
    function getResultsByItems()
    {
        results = new Map()

        for(let i = 0 ; i < CURRENT_QUESTION; i++)
        {
            ANSWERS.get(QUESTIONS[i])
        }
        assert(true==false)
    }

    function questionAnswered(idClicked)
    {
      ANSWERS.set(QUESTIONS[CURRENT_QUESTION].q_id, idClicked)
      
      //Going to next question
      CURRENT_QUESTION++
      update()
    }

    //EXPORTER
    function exporter()
    {
      //Struct of the export :
      // |- Lists of Q (and subItems with id from hash)
      // |- ANSWERS 
      let myexport = {}
      myexport.questions = JSON.stringify(QUESTIONS)
      myexport.answers = JSON.stringify(Object.fromEntries(ANSWERS))
      myexport.belief = JSON.stringify(MY_BELIEF)
      myexport.scores = JSON.stringify(Object.fromEntries(ANSWERED_CATEGORIES))
      myexport.main = JSON.stringify(getMaxAnsweredCategories())
      myexport.agree = JSON.stringify(DO_I_AGREE_WITH_MY_STAND)

      var filename = "quizz_esat_results_"+Date.now()+".json"
      var file = new Blob([JSON.stringify(myexport)], {type: "text/json"});
      if (window.navigator.msSaveOrOpenBlob) // IE10+
        window.navigator.msSaveOrOpenBlob(file, filename);
      else { // Others
        var a = document.createElement("a"),
                url = URL.createObjectURL(file);
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(function() {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);  
        }, 0); 
      }


      //setTimeout(() => {print()},300) //in addition, open print dialog box
    }

    function getMaxAnsweredCategories()
    {
      resV = -1
      resK = -1

      for(let [key,value] of ANSWERED_CATEGORIES)
      {
        if(resV < value)
        {
          resV = value
          resK = key
        }
      }

      return resK
    }

    //IMPORTER
    function loadQuestions()
    {
      q1 = { "q_title" : "Comment d√©finiriez-vous la nature de la r√©alit√© ?",
          "items" : [
            {
              "i_title": "La r√©alit√© existe ind√©pendamment de l'humain.",
              "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
            },
            {
              "i_title": "La r√©alit√© est en partie construite socialement et subjectivement interpr√©t√©e.",
              "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
            },
            {
              "i_title": "Des faits socialement construits, non dirig√©s par des lois naturelles existent.",
              "categ": [
                {
                  "i_symb": "Interpr√©tativiste",
                  "w" : 1
                }
              ]
            }
          ]
        }

      q2 = { "q_title" : "Quelle est votre opinion sur la possibilit√© de conna√Ætre la r√©alit√© ?",
          "items" : [
            {
              "i_title": "Le r√©el est connu avec une √©ventuelle d√©faillance des instruments de mesure.",
              "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
            },
            {
              "i_title": "Le domaine r√©el n'est pas observable mais des √©v√©nements sont observables.",
              "categ": [
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                },
              ]
            },
            {
              "i_title": "L'exp√©rience humaine est observable dans le syst√®me auquel elle appartient.",
              "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                }
              ]
            },
            {
              "i_title": "Des faits sont produits comme une partie des interactions sociales entre des chercheurs et des individus.",
              "categ": [
                {
                  "i_symb" : "Interpr√©tativiste",
                  "w" : 3
                }
              ]
            }
          ]
        }
      q3 = { "q_title" : "Quel est l'objectif de la connaissance scientifique produite ?",
      "items" : [
        {
          "i_title": "L'objectif de la connaissance scientifique est d'identifier des r√©gularit√©s, des invariants.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "L'objectif de la connaissance scientifique est d'identifier des m√©canismes g√©n√©rateurs.",
          "categ": [
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "L'objectif de la connaissance scientifique est de construire des mod√®les intelligibles de l'exp√©rience humaine offrant des rep√®res, des outils adapt√©s.",
          "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "L'objectif de la connaissance scientifique est de comprendre comment les individus donnent du sens aux exp√©riences sociales qu'ils vivent.",
          "categ": [
                {
                  "i_symb": "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }
      
      q4 = { "q_title" : "Comment consid√©rez-vous la production de la connaissance scientifique ?",
      "items" : [
        {
          "i_title": "La connaissance scientifique est produite par l'application rigoureuse de m√©thodes exp√©rimentales contr√¥l√©es.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "La connaissance scientifique est produite gr√¢ce l'observation d'√©v√©nements dans le syst√®me auquel ils appartiennent.",
          "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "La connaissance scientifique est produite √† travers un processus de co-construction sociale, o√π les interactions entre les chercheurs et les individus concourent √† cette construction.",
          "categ": [
                {
                  "i_symb": "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }

        q5 = { "q_title" : "Comment percevez-vous le r√¥le des valeurs personnelles et des croyances dans la formation des connaissances ?",
      "items" : [
        {
          "i_title": "Les valeurs personnelles doivent √™tre mises de c√¥t√© pour parvenir √† une compr√©hension objective de la r√©alit√©.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Les valeurs personnelles influencent in√©vitablement nos perspectives et nos interpr√©tations.",
          "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Les valeurs personnelles sont n√©cessaires pour construire  et interpr√©ter les connaissances.",
          "categ": [
                {
                  "i_symb" : "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }

        q6 = { "q_title" : "Quelle est votre attitude envers les biais et la subjectivit√© dans la connaissance scientifique ?",
      "items" : [
        {
          "i_title": "La subjectivit√© doit √™tre minimis√©e pour parvenir √† une compr√©hension objective de la r√©alit√©.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Les biais sont in√©vitables et il est important de les reconna√Ætre et de les g√©rer.",
          "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "La subjectivit√© fait partie de la construction de la connaissance.",
"categ": [
                {
                  "i_symb" : "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }

        q7 = { "q_title" : "Quelle est votre attitude envers le r√¥le des contextes sociaux et historiques dans la production de la connaissance ?",
      "items" : [
        {
          "i_title": "Les contextes sociaux et historiques sont secondaires pour la construction de la connaissance.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Les contextes sociaux et historiques sont importants pour la construction de la connaissance.",
          "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Les contextes sociaux et historiques sont fondamentaux pour la construction de la connaissance.",
          "categ": [
                {
                  "i_symb" : "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }

        q8 = { "q_title" : "Quel mat√©riau empirique est mobilis√© pour construire la connaissance ?",
      "items" : [
        {
          "i_title": "Pour construire et valider des connaissances scientifiques, des donn√©es quantitatives sont √©labor√©es √† partir de plans exp√©rimentaux contr√¥l√©s.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Pour construire et √©valuer des connaissances scientifiques, l'observation d'√©v√®nements dans diff√©rents contextes est n√©cessaire",
          "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Pour construire et √©valuer la connaissance scientifique, des narrations aupr√®s d'individus sont recueillies.",
          "categ": [
                {
                  "i_symb": "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }

        q9 = { "q_title" : "Quelle forme prend la connaissance ?",
      "items" : [
        {
          "i_title": "La connaissance scientifique prend la forme d'√©nonc√©s r√©futables, d'invariants.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "La connaissance scientifique prend la forme de mod√®les g√©n√©riques, de leur mode d'activation en contexte et d'outils pragmatiques.",
          "categ": [
                {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "La connaissance scientifique prend la forme de narrations soutenues par des descriptions de l'exp√©rience v√©cue lors des interactions avec les individus.",
          "categ": [
                {
                  "i_symb" : "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }

        q10 = { "q_title" : "Sur quoi repose la fiabilit√© du processus de production et d‚Äôanalyse des donn√©es ?",
      "items" : [
        {
          "i_title": "La fiabilit√© de production et d'analyse des donn√©es repose sur la capacit√© √† pouvoir reproduire les r√©sultats exp√©rimentaux. La r√©plication et la fiabilit√© des mesures reposent sur la description du protocole et des donn√©es.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "La fiabilit√© de production et d'analyse des donn√©es repose sur la description du cheminement cognitif pour construire la connaissance et sa tra√ßabilit√©.",
          "categ": [
          {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "La fiabilit√© de production et d'analyse des donn√©es repose sur le recueil de nombreuses narrations et la mani√®re dont les interpr√©tations des narrations sont v√©rifi√©es.",
          "categ": [
                {
                  "i_symb" : "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }

        q11 = { "q_title" : "Comment la connaissance est-elle mise √† l'√©preuve ?",
      "items" : [
        {
          "i_title": "Des tests statistiques sont r√©alis√©s pour valider ou invalider des hypoth√®ses, permettant de tester la connaissance.",
          "categ": [
                {
                  "i_symb": "Post-Positivisme",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Pour √©prouver la connaissance, le mod√®le et ses effets doivent √™tre test√©s dans des contextes diff√©rents.",
          "categ": [
              {
                  "i_symb": "Constructivisme Pragmatique",
                  "w" : 1
                },
                {
                  "i_symb": "R√©alisme Critique",
                  "w" : 1
                }
              ]
        },
        {
          "i_title": "Il n'y a pas besoin de mettre √† l'√©preuve la connaissance une fois produite.",
          "categ": [
                {
                  "i_symb" : "Interpr√©tativiste",
                  "w" : 1
                }
              ]
        }
        
          ]
        }
            
      QUESTIONS.push(q1)
      QUESTIONS.push(q2)
      QUESTIONS.push(q3)
      QUESTIONS.push(q4)
      QUESTIONS.push(q5)
      QUESTIONS.push(q6)
      QUESTIONS.push(q7)
      QUESTIONS.push(q8)
      // QUESTIONS.push(q9) // REMOVING Q9 FROM QBANK
      QUESTIONS.push(q10)
      QUESTIONS.push(q11)

      //Creating an id for each i_title of each item of each question, using a (not secure!) hash function
      for(i in QUESTIONS)
      {
        QUESTIONS[i].q_id = hashCode(QUESTIONS[i].q_title)
        QUESTIONS[i].items = QUESTIONS[i].items.map(function(item){
            return {i_title:item.i_title,i_id:hashCode(item.i_title),categ:item.categ}
        })
      }

       
       updateAvailableCategories()
    }

    function loadEpistemologyStands()
    {
      // Post-Positivisme
      def = "Le post-positivisme est une posture √©pist√©mologique qui consid√®re que la connaissance scientifique est toujours incertaine et sujette √† r√©vision. Il reconna√Æt que les observations sont influenc√©es par des biais et des contextes th√©oriques, et que la recherche doit √™tre guid√©e par une approche critique et r√©flexive. Le post-positivisme met l'accent sur la rigueur m√©thodologique, l'importance de la triangulation des donn√©es et l'id√©e que les th√©ories ne sont jamais d√©finitivement prouv√©es, mais peuvent √™tre continuellement test√©es et am√©lior√©es pour mieux refl√©ter la r√©alit√©."
      EPISTEMOLOGY_STAND_DEF["Post-Positivisme"] = def

      // Constructivisme Pragmatique
      def = "Le constructivisme pragmatique est une posture √©pist√©mologique qui consid√®re que la connaissance est activement construite par les individus √† travers leurs exp√©riences, interactions sociales et contextes sp√©cifiques. Elle met l‚Äôaccent sur l‚Äôutilit√© et l‚Äôefficacit√© de la connaissance dans la r√©solution de probl√®mes r√©els, plut√¥t que sur une qu√™te de v√©rit√© absolue. La valeur d‚Äôune id√©e ou d‚Äôune th√©orie est √©valu√©e en fonction de son application pratique et de sa capacit√© √† produire des r√©sultats concrets dans des situations donn√©es, tout en tenant compte des perspectives et des constructions sociales des acteurs impliqu√©s."
      EPISTEMOLOGY_STAND_DEF["Constructivisme Pragmatique"] = def

      // Interpr√©tativisme
      def = "L'interpr√©tativisme est une posture √©pist√©mologique qui soutient que la r√©alit√© sociale est construite par les significations et les interpr√©tations des individus. Elle se concentre sur la compr√©hension des exp√©riences humaines, des croyances et des pratiques culturelles, en tenant compte du contexte historique et social. L‚Äôinterpr√©tativisme privil√©gie les m√©thodes qualitatives et cherche √† saisir la perspective subjective des acteurs pour acc√©der √† une compr√©hension profonde des ph√©nom√®nes sociaux. Cette approche valorise l'analyse des significations partag√©es et des interactions symboliques qui fa√ßonnent la r√©alit√© per√ßue par les individus."
      EPISTEMOLOGY_STAND_DEF["Interpr√©tativiste"] = def

      // R√©alisme Critique
      def = "Le r√©alisme critique est une posture √©pist√©mologique qui affirme l'existence d'une r√©alit√© objective ind√©pendante de notre perception, tout en reconnaissant que notre connaissance de cette r√©alit√© est toujours partielle et m√©di√©e par nos concepts, th√©ories et interpr√©tations. Il distingue entre le monde r√©el (structures, m√©canismes) et notre connaissance (repr√©sentations, perceptions) de ce monde. Le r√©alisme critique cherche √† identifier les structures et les causes sous-jacentes aux ph√©nom√®nes observables, en consid√©rant √† la fois les dimensions empiriques et les contextes sociaux qui influencent notre compr√©hension du r√©el."
      EPISTEMOLOGY_STAND_DEF["R√©alisme Critique"] = def

    }

    function updateAvailableCategories()
    {
      for(q in QUESTIONS)
      {
        for(i in QUESTIONS[q].items)
        {
          for(s in QUESTIONS[q].items[i].categ)
          {
            const csymb = QUESTIONS[q].items[i].categ[s].i_symb
            if(CATEGORIES.has(csymb))
              CATEGORIES.set(csymb,CATEGORIES.get(csymb)+1)
            else
              CATEGORIES.set(csymb,1)
          }
        }
      }
    }

    //TOOL
    function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function maxOfAMap(mp)
    {
      return (Array.from(CATEGORIES, ([key,value]) => value).reduce((a,x) => a < x ? x : a ))
    }

    /**
     * Returns a hash code from a string
     * @param  {String} str The string to hash.
     * @return {Number}    A 32bit integer
     * @see http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/
     */
    function hashCode(str) {
        let hash = 0;
        for (let i = 0, len = str.length; i < len; i++) {
            let chr = str.charCodeAt(i);
            hash = (hash << 5) - hash + chr;
            hash |= 0; // Convert to 32bit integer
        }
        return hash;
    }

    function displayRadar()
    {
      resAxes = [{className:"result", axes:Array.from(ANSWERED_CATEGORIES,function([key,val]) { return {axis:key, value:val}})}]
      
      var chart = RadarChart.chart();
      var cfg = chart.config(); // retrieve default config
      cfg.maxValue = maxOfAMap(ANSWERED_CATEGORIES)
      var svg = d3.select('#radar').append('svg')
        .attr('width', cfg.w)// + cfg.w + 50)
        .attr('height', cfg.h)// + cfg.h / 4);
      svg.append('g').classed('single', 1).datum(resAxes).call(chart);
      
      // // many radars
      // chart.config({w: cfg.w / 4, h: cfg.h / 4, axisText: false, levels: 0, circles: false});
      // cfg = chart.config();
      // function render() {
      //   var game = svg.selectAll('g.game').data(
      //     [
      //       randomDataset(),
      //       randomDataset(),
      //       randomDataset(),
      //       randomDataset()
      //     ]
      //   );
      //   game.enter().append('g').classed('game', 1);
      //   game
      //     .attr('transform', function(d, i) { return 'translate('+((cfg.w * 4) + 50 + (i * cfg.w))+','+ (cfg.h * 1.3) +')'; })
      //     .call(chart);
      
      //   setTimeout(render, 1000);
      // }
      //render();
    }

    function removeRadar()
    {
      var rad = d3.selectAll('svg').remove()
    }
  </script>
</body>