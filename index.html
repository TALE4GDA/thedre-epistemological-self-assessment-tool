<head>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';

    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
</head>
<body>
  <h1 class="md-typescale-display-medium">Quizz Epistemologie</h1>
  <md-linear-progress id="progress" value="0"></md-linear-progress>
  <form id="mainForm">
    <p id="quizz" class="md-typescale-body-medium">Check out these controls in a form!</p>
    <md-outlined-button type="reset" onclick="Aclicked()">A</md-outlined-button>
    <md-outlined-button type="reset" onclick="Bclicked()">B</md-outlined-button>
    <md-outlined-button type="reset"onclick="Cclicked()">C</md-outlined-button>
  </form>
  <style>
    form {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }
  </style>
  <script>
    NO_ANSWER = "X"
    CURRENT_QUESTION = 0

    QUIZZ_ELEMENT = document.getElementById("mainForm")

    RANDOMIZE_QUESTIONS = true
    RANDOMIZE_ITEMS = true

    QUESTIONS = []

    loadQuestions()
    

    // questions = ["Comment définiriez-vous la nature de la réalité ?",
    // "Quelle est votre opinion sur la possibilité de connaître la réalité ?",
    // "Comment considérez-vous la production de la connaissance scientifique ?",
    // "Comment percevez-vous le rôle des valeurs personnelles et des croyances dans la formation des connaissances ?",
    // "Comment évaluez-vous la validité de la connaissance scientifique produite ?",
    // "Quelle est votre attitude envers les biais et la subjectivité dans la connaissance scientifique ?",
    // "Quelle est votre attitude envers le rôle des contextes sociaux et historique dans la production de la connaissance ?",
    // "Comment percevez-vous la relation entre théorie et observation ?"
    // ]

    ANSWERS = new Map()
    for(q in QUESTIONS)
    {
        ANSWERS.set(QUESTIONS[q].q_title,NO_ANSWER)
    }
    
    initQuizz()

    function update()
    {
        prog = document.getElementById("progress")
        val = CURRENT_QUESTION/QUESTIONS.length*1.0
        prog.value = ""+ val

        if(val == 1.0)
        {
          quizzEnd()
          return; // RETURN IF END ! Otherwise continue
        }


        quizzQ = '<p id="quizz" class="md-typescale-body-medium">'+QUESTIONS[CURRENT_QUESTION].q_title+'</p>'

        let items = QUESTIONS[CURRENT_QUESTION].items
        
        //Building appropriate buttons for the quizz
        let quizzButtons = []

        for (i in items)
        {
         quizzButtons.push('<md-outlined-button type="reset" data-symb="'+items[i].i_symb+'">'+items[i].i_title+'</md-outlined-button>')
        }

        if(RANDOMIZE_ITEMS)
          shuffleArray(quizzButtons)

        QUIZZ_ELEMENT.innerHTML = quizzQ + quizzButtons.join("")
    }

    function initQuizz()
    {
      if(RANDOMIZE_QUESTIONS)
        shuffleArray(QUESTIONS)
      
      QUIZZ_ELEMENT.addEventListener('click', addClick)
      CURRENT_QUESTION = 0
      update()
    }

    function addClick(event)
    {
        const isButton = event.target
        if(!isButton.dataset.symb)
          return; //NTD false click
        questionAnswered(event.target.dataset.symb)
    }

    function quizzEnd()
    {
        QUIZZ_ELEMENT.innerHTML = '<p id="quizz" class="md-typescale-body-medium">Le quizz est fini.Merci.</p>'+
        '<md-outlined-button type="reset" onclick="initQuizz()">Recommencer le quizz ?</md-outlined-button>'
        
        //SHOULD DISPLAY THE NUMBER OF ANSWERS BY ITEM
        let symbCounter = answersToSymbMap()
        display = ""
        for(let[key,value] of symbCounter)
        {
          display += '<p>'+key+' : <md-linear-progress id="progress" value="'+value/QUESTIONS.length+'"></md-linear-progress></p>'
        }

        QUIZZ_ELEMENT.innerHTML+=display
        
    }

    function answersToSymbMap()
    {
      let symbCounter = new Map()

        for(let [key,value] of ANSWERS)
        {
          if(symbCounter.has(value))
            symbCounter.set(value,symbCounter.get(value)+1)
          else
            symbCounter.set(value,1)
        }
      return symbCounter
    }

    // This function is used to classify the epistemological stand of the user
    function classify()
    {
      assert(true == false)
    }

    // @TODO
    function getResultsByItems()
    {
        results = new Map()

        for(let i = 0 ; i < CURRENT_QUESTION; i++)
        {
            ANSWERS.get(QUESTIONS[i])
        }
        assert(true==false)
    }

    function questionAnswered(symbClicked)
    {
      ANSWERS.set(QUESTIONS[CURRENT_QUESTION].q_title, symbClicked)
      
      //Going to next question
      CURRENT_QUESTION++
      update()
    }

    //IMPORTER
    function loadQuestions()
    {
      q1 = { "q_title" : "Comment définiriez-vous la nature de la réalité ?",
          "items" : [
            {
              "i_title": "La Réalité est objective et existe indépendamment de nos perceptions",
              "i_symb": "A"
            },
            {
              "i_title": "La réalité est en partie construite socialement et subjectivement interprétée",
              "i_symb": "B"
            },
            {
              "i_title": "La réalité est une construction en constante évolution, influencée par nos interactions avec le monde",
              "i_symb" : "C"
            }
          ]
        }

      q2 = { "q_title" : "Quelle est votre opinion sur la possibilité de connaître la réalité ?",
          "items" : [
            {
              "i_title": "La réalité est connaissable de manière objective à travers des observations empiriques précises.",
              "i_symb": "A"
            },
            {
              "i_title": "La réalité est connaissable, mais nos observations sont influencées par nos théories et préjugés.",
              "i_symb": "B"
            },
            {
              "i_title": "La connaissance de la réalité est construite par les individus à travers leurs interactions et expériences pratiques.",
              "i_symb" : "C"
            }
          ]
        }
      q3 = { "q_title" : "Comment considérez-vous la production de la connaissance scientifique ?",
      "items" : [
        {
          "i_title": "La connaissance scientifique est produite par l'application rigoureuse de méthodes empiriques et expérimentales.",
          "i_symb": "A"
        },
        {
          "i_title": "La connaissance scientifique est produite en reconnaissant et en testant continuellement les théories pour mieux comprendre les biais et les limitations.",
          "i_symb": "B"
        },
        {
          "i_title": "La connaissance scientifique est produite à travers un processus de co-construction sociale, où les interactions entre les chercheurs et les participants jouent un rôle crucial.",
          "i_symb" : "C"
        }
      ]
      }

      QUESTIONS.push(q1)
      QUESTIONS.push(q2)
      QUESTIONS.push(q3)
    }

    //TOOL
    function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>